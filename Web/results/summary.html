<head>
<title>cncfdemo</title>
<link rel="stylesheet" type="text/css" href="main.css">
</head>

<body>

  <header>
    <div id="logo"><img src="img/logo_cncf.png"></div>
    <h1>Results</h1>
  </header>

  <main>
   <article id="centercolumn">
    

      <div class="table-row table-header">
        <h1>Provider</h1>
        <h1>CPU Cores</h1>
        <h1>Memory</h1>
        <h1>DistCC</h1>
        <h1>HTTP Requests</h1>
        <h1>Boinc Jobs</h1>
      </div>

    <div class="table-wrap">

      <template class="Results">

      <div class="table-row" id="results">
        <div>${ Provider }</div>
        <div>${ CPU }</div>
        <div>${ Memory }</div>
        <div>${ DistCC }</div>
        <div>${ HTTP_Requests }</div>
        <div>${ Boinc_Jobs }</div>
      </div>
      </template>
      </div>


  </article>

</main>

  <footer><span>Copyright © 2016 The Linux Foundation®. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page. Linux is a registered trademark of Linus Torvalds. Privacy Policy and Terms of Use</span></footer>

</body>


<script>

const polyfills = ['js/fetch.js', 'js/url-search-params.js'];
const loadScripts = srcList => {

  const succeeded = new Set();
  return new Promise( (ok, err) => {

    srcList.forEach( src => {

      const js = document.createElement('script'); js.src = src;
      js.onerror = () => err(new Error('Failed to load script ' + src));
      js.onload  = () => { succeeded.add(src); 
                           (polyfills.filter(p => !succeeded.has(p)).length === 0) ? ok(succeeded) : 'wait'; }

      document.head.appendChild(js);

    })

  })

}


const humanize = t => { m = Math.floor(t / 60); return `${ (m > 0) ? m+' minutes,' : '' } ${ Math.floor(t % 60) } seconds` }
const Render = (template, contexts, g) => {

  rendered = '';
  [].concat(contexts).forEach( (context, _index) => {

    with (context) {
      rendered += eval('`'+template.innerHTML+'`');
    }


  })

  return rendered;

}


const main = () => {

  const urlParams = new URLSearchParams(window.location.search);
  const url = urlParams.get('id') ? urlParams.get('id') + '.json' : 'summary.json';
  const templates = document.getElementsByTagName('template');

  headers = {};
  const handleErrors = response => {

      headers = response.headers;
      contentType = headers.get('Content-Type');

      if (!response.ok) throw Error(response.statusText);
      if (!contentType === 'application/json') throw Error(contentType);

      return response.clone().json();

  }

  fetch(url)
    .then(handleErrors)
    .catch(Err => (console.log(Err) ))
    .then(data => { if (!data) { console.log('Fetch Failed') } else {

    console.log(data);


    Array.from(templates).forEach( template => {

      contexts = data[template.className];
      rendered = Render(template, contexts, data);
      template.parentElement.innerHTML = rendered + template.outerHTML;

    })


    }

    })

}


if (!window.fetch) {
  loadScripts(polyfills)
    .then(response => { console.log('Polyfills loaded: ', response); main(); }, Err => console.log(Err))
} else { main() }

</script>
